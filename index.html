<html>  
  <head>
    <title>gHost - unHosted Photo Album using WebRTC</title>
    <link href="css/lightbox.css" rel="stylesheet" />
    <link href="css/ghost.css" rel="stylesheet" />
    <link href="css/buttons.css" rel="stylesheet" />
    <link href='http://fonts.googleapis.com/css?family=Metal+Mania&text=gHost%20unHosted%20Photo%20Album' rel='stylesheet' type='text/css'>
    <script src="js/remoteStorage.js" type="text/javascript"></script>
    <script src="js/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="remote.js" type="text/javascript"></script>
    <script src="helper.js" type="text/javascript"></script>
    <script src="app.js" type="text/javascript"></script>
    <script src="js/lightbox.js" type="text/javascript"></script>
    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript" src="http://s.sharethis.com/loader.js"></script>
    <script type="text/javascript">
      var picture_key;
      var myStream;

      function getPic(error, data) {
        if (!error && data !== undefined) {
          $('#album').append('<a href="' + data + '" rel="lightbox[gHost]"><img src="' + data + '" id="' + picture_key + '" width="160" height="120"></img></a>');
          /* Canvas loose some pics :(
          $('#album').append('<a href="'+data+'" rel="lightbox[gHost]"><canvas id="'+picture_key+'" width="160" height="120"></canvas></a>');
	  var ctx = document.getElementById(picture_key).getContext("2d");
	  var myImage = new Image();
	  myImage.src = data;
	  ctx.drawImage(myImage, 0, 0, 160, 120);
          */
          picture_key = picture_key + 1;
          
          /* recursive discovery of category, since I guess remotestoragejs
          does not include a category listing method yet
          */
          storage.getData('pictures/ghost/' + picture_key, getPic);
        } else {
          helper.hideSpinner();
          $('#takePhoto').show();
        }
      }

      function init() {
        if (helper.isConnected()) {
          if (navigator.webkitGetUserMedia) navigator.webkitGetUserMedia({
            video: true
          }, onSuccess, onFail);
          else alert('webRTC not available');
        }
      }

      function onSuccess(stream) {
        myStream = stream;
        $('#camFeed').attr('src', webkitURL.createObjectURL(stream));
        $('#camFeed').css({
          'margin-top': '10px',
          'margin-bottom': '20px',
          'box-shadow': '0 0 50px 10px #fff'
        });
        $('#camerabox').fadeIn('slow')
      }

      function onFail() {
        alert('could not connect stream');
      }
    </script>
  </head>
  
  <body>
    <center>
      <div id="splash">
        <img src="images/logo.png">
        <span class="title">gHost</span>
        <span class="subtitle">unHosted Photo Album</span>
      </div>
      <div id="login">
        <a id="question" href="#" onClick="window.open('http://unhosted.org/en/a/register.html','Get your remote storage','width=820,height=800,top=0,left=0');">?</a>
        <input type="text" id="userAddress" placeholder="user@remotestorage.com">
        <button class="blue-pill" id="connect">Connect</button>
        <button class="blue-pill" id="disconnect" style="display: none">Disconnect</button>
        <br>



      </div>
      <div id="camerabox" style="display:none">
        <video id="camFeed" width="320" height="240" autoplay></video>
        <button class="blue-pill" id="takePhoto" style="display: none">Take Photo</button>
        <button class="blue-pill" id="savePhoto" style="display: none">Save Photo</button>
      </div>
      <img id="spinner" src="images/ajax-loader.gif" style="display:none">
      <div id="info">
	<p><b>gHost</b> is an experimental web application<br>
        based on HTML5, CSS3 and JavaScript.</p>
        <p><b>gHost</b> uses <a href="http://jquery.com/" target="_blank">JQuery</a> and two new great technologies called<br>
        <a href="http://www.webrtc.org/" target="_blank">WebRTC</a> and <a href="http://remotestoragejs.com/" target="_blank">RemoteStorageJS</a>;
        used, respectively,<br>to capture the webcam stream without plugins and<br>to host the pictures taken, leaving users in control of their data.</p>
        <p><b>gHost</b> is hosted on <a href="https://github.com/vcuculo/ghost-unhosted-webrtc" target="_blank">GitHub</a></p>
        <p style="font: 15px 'Courier New'">/* Author: Vittorio Cuculo */</p>
      </div>
    </center>
  </body>
  <script>
  var options={ "publisher": "ur-45cabb71-babe-bd30-6be0-d0f0d1a4e87d", "position": "left", "ad": { "visible": false, "openDelay": 5, "closeDelay": 0}, "chicklets": { "items": ["facebook", "twitter", "googleplus", "pinterest"]}};
  var st_hover_widget = new sharethis.widgets.hoverbuttons(options);
  </script>
</html>
